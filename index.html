<!DOCTYPE html>
<html>

<head>
    <title>Registro de alumnos</title>
    <link rel="stylesheet" href="w3.css">
</head>

<body class="w3-content">
    <div justify-content="center" class="w3-container w3-center">
        <div class="w3-light-blue">
            <h2>Registrar alumno</h2>
        </div>
        <br>

        <form id="formRegistro">
            <label>Nombre:</label>
            <br>
            <input type="text" id="nombre" required>
            <br><br>

            <label>Calificacion:</label>
            <br>
            <input type="number" id="calif" required>
            <br><br>

            <button onclick="guardarEnGitHub()" class="w3-button w3-green w3-hover-light-green w3-ripple">
                Guardar registro
            </button>
        </form>

        <div class="w3-light-blue">
            <h2>Tabla de registros</h2>
        </div>
        <br>

        <table class="w3-table-all w3-center" border="1" id="tablaRegistros">
            <thead>
                <tr class="w3-cyan">
                    <th>Nombre</th>
                    <th>Calificación</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>

        <br>
        <button class="w3-button w3-green w3-hover-light-green w3-ripple" onclick="descargarJSON()">Descargar
            JSON</button>

        <script>
            fetch("https://raw.githubusercontent.com/OscarMoreno203/registro_alumnos/refs/heads/main/registros.json")
                .then(r => r.json())
                .then(data => {
                    registros = data;
                    mostrarTabla();
                })
                .catch(() => console.log("No hay registros aún"));

            let registros = [];

            document.getElementById("formRegistro").addEventListener("submit", function (e) {
                e.preventDefault();

                const nombre = document.getElementById("nombre").value;
                const calif = document.getElementById("calif").value;

                registros.push({ nombre, calif });

                mostrarTabla();
                this.reset();
            });

            function mostrarTabla() {
                const tbody = document.querySelector("#tablaRegistros tbody");
                tbody.innerHTML = "";

                registros.forEach(reg => {
                    const fila = `<tr><td>${reg.nombre}</td><td>${reg.calif}</td></tr>`;
                    tbody.innerHTML += fila;
                });
            }

            function descargarJSON() {
                const blob = new Blob([JSON.stringify(registros, null, 2)], { type: "application/json" });
                const url = URL.createObjectURL(blob);

                const a = document.createElement("a");
                a.href = url;
                a.download = "registros.json";
                a.click();
            }

            async function guardarEnGitHub() {
                const respuesta = await fetch("https://registro-alumnos-f9n4sjs5g-oscarmoreno203s-projects.vercel.app/api/guardar", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify({ registros })
                });

                const data = await respuesta.json();
                alert("Registros guardados en GitHub :)");
            }

        </script>
    </div>

</body>

</html>



